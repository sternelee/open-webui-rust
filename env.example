# ========================================
# Open WebUI - Docker Compose Configuration
# ========================================
#
# This file is for Docker Compose deployments (docker-compose.yaml and docker-compose.dev.yaml)
#
# USAGE:
# 1. Copy this file to .env in the project root:
#    cp env.example .env
#
# 2. Edit the .env file and set your values (especially WEBUI_SECRET_KEY)
#
# 3. Start with Docker Compose:
#    docker compose up -d                           (production)
#    docker compose -f docker-compose.dev.yaml up -d (development)
#
# NOTE: For local Rust development (cargo run), use rust-backend/env.example instead.
#
# ========================================

# ----------------------------------------
# PostgreSQL Database Configuration
# ----------------------------------------
# Note: For docker-compose.dev.yaml (development), these match rust-backend/.env defaults
# For production, use stronger credentials
POSTGRES_DB=openwebui
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_PORT=5432

# ----------------------------------------
# Redis Configuration
# ----------------------------------------
REDIS_PORT=6379

# ----------------------------------------
# ChromaDB Configuration
# ----------------------------------------
CHROMA_PORT=8000
CHROMA_TELEMETRY=FALSE

# ----------------------------------------
# Server Configuration
# ----------------------------------------
HOST=0.0.0.0
RUST_PORT=8080
SOCKETIO_PORT=8081
OPEN_WEBUI_PORT=3000
ENV=prod

# ----------------------------------------
# Security & Authentication
# ----------------------------------------
# IMPORTANT: Set a fixed secret key to persist JWT tokens across restarts
# Generate a strong secret key (e.g., using: openssl rand -hex 32 or uuidgen)
# Example: WEBUI_SECRET_KEY=your-32-char-secret-key-here
WEBUI_SECRET_KEY=

# JWT Configuration
JWT_EXPIRES_IN=30d

# Authentication Options
ENABLE_SIGNUP=true
ENABLE_LOGIN_FORM=true
ENABLE_API_KEY=true
DEFAULT_USER_ROLE=user
SHOW_ADMIN_DETAILS=true

# ========================================
# OAuth Authentication
# ========================================
# For detailed setup instructions, see: docs/OAUTH_SETUP_GUIDE.md

# ----------------------------------------
# General OAuth Settings
# ----------------------------------------
ENABLE_OAUTH_SIGNUP=false
OAUTH_MERGE_ACCOUNTS_BY_EMAIL=false
ENABLE_OAUTH_PERSISTENT_CONFIG=false

# Frontend URL (used for OAuth redirects)
FRONTEND_BASE_URL=http://localhost:3000

# OAuth Session Encryption (REQUIRED if using OAuth)
# Generate a secure Fernet key using: python3 -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
OAUTH_SESSION_TOKEN_ENCRYPTION_KEY=

# OAuth Client Info Encryption (for MCP tools)
OAUTH_CLIENT_INFO_ENCRYPTION_KEY=

# ID Token Cookie (optional)
ENABLE_OAUTH_ID_TOKEN_COOKIE=false

# ----------------------------------------
# OAuth Provider - Google
# ----------------------------------------
# Get credentials from: https://console.cloud.google.com/apis/credentials
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
GOOGLE_OAUTH_SCOPE=openid email profile
GOOGLE_REDIRECT_URI=http://localhost:8080/oauth/google/callback

# ----------------------------------------
# OAuth Provider - Microsoft
# ----------------------------------------
# Get credentials from: https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade
MICROSOFT_CLIENT_ID=
MICROSOFT_CLIENT_SECRET=
MICROSOFT_CLIENT_TENANT_ID=common
MICROSOFT_OAUTH_SCOPE=openid email profile
MICROSOFT_REDIRECT_URI=http://localhost:8080/oauth/microsoft/callback

# ----------------------------------------
# OAuth Provider - GitHub
# ----------------------------------------
# Get credentials from: https://github.com/settings/developers
GITHUB_CLIENT_ID=
GITHUB_CLIENT_SECRET=
GITHUB_OAUTH_SCOPE=read:user user:email
GITHUB_REDIRECT_URI=http://localhost:8080/oauth/github/callback

# ----------------------------------------
# OAuth Provider - Generic OIDC
# ----------------------------------------
# Use for Keycloak, Auth0, Okta, etc.
OIDC_PROVIDER_NAME=OIDC
OIDC_CLIENT_ID=
OIDC_CLIENT_SECRET=
OIDC_DISCOVERY_URL=
OIDC_OAUTH_SCOPE=openid email profile
OIDC_REDIRECT_URI=http://localhost:8080/oauth/oidc/callback

# ----------------------------------------
# OAuth Provider - Feishu/Lark
# ----------------------------------------
# Get credentials from: https://open.feishu.cn/app
FEISHU_CLIENT_ID=
FEISHU_CLIENT_SECRET=
FEISHU_OAUTH_SCOPE=contact:user.base:readonly
FEISHU_REDIRECT_URI=http://localhost:8080/oauth/feishu/callback

# ----------------------------------------
# OAuth Claims Mapping
# ----------------------------------------
# Customize which OAuth claims to use for user data
OAUTH_USERNAME_CLAIM=name
OAUTH_EMAIL_CLAIM=email
OAUTH_PICTURE_URL_CLAIM=picture

# Role management from OAuth claims
OAUTH_ROLES_CLAIM=roles
OAUTH_ALLOWED_ROLES=user,admin
OAUTH_ADMIN_ROLES=admin

# Group management from OAuth claims
OAUTH_GROUPS_CLAIM=groups
OAUTH_ALLOWED_GROUPS=
OAUTH_BLOCKED_GROUPS=

# ----------------------------------------
# OAuth Role Management
# ----------------------------------------
# Default role for new OAuth users
# DEFAULT_USER_ROLE=pending (already set above in Authentication Options)

# Email domain restrictions
OAUTH_ALLOWED_DOMAINS=
# Example: OAUTH_ALLOWED_DOMAINS=company.com,example.org

# First user becomes admin
ENABLE_OAUTH_FIRST_USER_ADMIN=true

# ----------------------------------------
# OAuth Security
# ----------------------------------------
# Enable PKCE (Proof Key for Code Exchange) - Recommended
ENABLE_OAUTH_PKCE=true

# Profile picture size limit (in bytes, default 2MB)
OAUTH_PROFILE_PICTURE_MAX_SIZE=2097152

# ----------------------------------------
# OAuth Webhooks
# ----------------------------------------
# Webhook notifications for OAuth events
WEBHOOK_URL=
# Example: WEBHOOK_URL=https://your-server.com/webhook

# ----------------------------------------
# Database Connection (Rust Backend)
# ----------------------------------------
# Auto-constructed from POSTGRES_* vars, but can be overridden
# For docker-compose: postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@postgres:5432/${POSTGRES_DB}
# For local dev: postgresql://postgres:postgres@localhost:5432/openwebui
# DATABASE_URL=postgresql://postgres:postgres@postgres:5432/openwebui

DATABASE_POOL_SIZE=20
DATABASE_POOL_MAX_OVERFLOW=10
DATABASE_POOL_TIMEOUT=30
DATABASE_POOL_RECYCLE=1800

# ----------------------------------------
# Redis Configuration (Rust Backend)
# ----------------------------------------
ENABLE_REDIS=true
# REDIS_URL=redis://redis:6379

# ----------------------------------------
# WebSocket/Socket.IO Configuration
# ----------------------------------------
ENABLE_WEBSOCKET_SUPPORT=true
WEBSOCKET_MANAGER=redis
# WEBSOCKET_REDIS_URL=redis://redis:6379

# ----------------------------------------
# CORS Configuration
# ----------------------------------------
CORS_ALLOW_ORIGIN=*
CORS_ORIGINS=*

# ----------------------------------------
# Application Features
# ----------------------------------------
ENABLE_OPENAI_API=true
ENABLE_CHANNELS=true
ENABLE_IMAGE_GENERATION=false
ENABLE_CODE_EXECUTION=false
ENABLE_WEB_SEARCH=false
ENABLE_ADMIN_CHAT_ACCESS=true
ENABLE_ADMIN_EXPORT=true
ENABLE_NOTES=true
ENABLE_COMMUNITY_SHARING=true
ENABLE_MESSAGE_RATING=true

# ----------------------------------------
# Storage Configuration
# ----------------------------------------
UPLOAD_DIR=/app/data/uploads
CACHE_DIR=/app/data/cache
STATIC_DIR=/app/static

# ----------------------------------------
# Logging Configuration
# ----------------------------------------
GLOBAL_LOG_LEVEL=info
RUST_LOG=info

# ----------------------------------------
# OpenAI Configuration
# ----------------------------------------
OPENAI_API_BASE_URL=
OPENAI_API_KEY=

# ----------------------------------------
# RAG & Embeddings (Python Backend)
# ----------------------------------------
RAG_EMBEDDING_MODEL=sentence-transformers/all-MiniLM-L6-v2
RAG_RERANKING_MODEL=
RAG_EMBEDDING_MODEL_AUTO_UPDATE=false

# RAG Search Options
ENABLE_RAG_WEB_SEARCH=false
ENABLE_RAG_HYBRID_SEARCH=false

# ----------------------------------------
# Whisper (Speech-to-Text)
# ----------------------------------------
WHISPER_MODEL=base

# ----------------------------------------
# Docker Build Arguments
# ----------------------------------------
BUILD_HASH=dev-build
USE_CUDA=false
USE_SLIM=false
USE_PERMISSION_HARDENING=false
USE_CUDA_VER=cu128
USE_EMBEDDING_MODEL=sentence-transformers/all-MiniLM-L6-v2
USE_RERANKING_MODEL=

# User/Group IDs (for non-root containers)
UID=0
GID=0

# ----------------------------------------
# Analytics & Tracking
# ----------------------------------------
SCARF_NO_ANALYTICS=true
DO_NOT_TRACK=true

# ----------------------------------------
# Application URLs (Internal)
# ----------------------------------------
WEBUI_URL=http://localhost:3000
BACKEND_URL=http://rust-backend:8080

